{% extends "base.html" %}

{% block title %}Settings - Earnings Dashboard{% endblock %}

{% block content %}
<div class="form-container">
    <h2>Settings</h2>
    <p class="settings-description">Configure your revenue distribution percentages. The three percentages must sum to 100%.</p>
    
    <form method="POST" action="{{ url_for('settings') }}" class="settings-form" onsubmit="return validatePercentages()">
        <div class="form-group">
            <label for="tax_percent">Tax Percentage (%)</label>
            <input type="number" id="tax_percent" name="tax_percent" step="0.1" min="0" max="100" value="{{ settings.tax_percent }}" required>
        </div>
        
        <div class="form-group">
            <label for="reinvest_percent">Reinvest Percentage (%)</label>
            <input type="number" id="reinvest_percent" name="reinvest_percent" step="0.1" min="0" max="100" value="{{ settings.reinvest_percent }}" required>
        </div>
        
        <div class="form-group">
            <label for="take_home_percent">Take-Home Percentage (%)</label>
            <input type="number" id="take_home_percent" name="take_home_percent" step="0.1" min="0" max="100" value="{{ settings.take_home_percent }}" required>
        </div>
        
        <div class="percentage-summary">
            <strong>Total: <span id="total_percent">{{ settings.tax_percent + settings.reinvest_percent + settings.take_home_percent }}</span>%</strong>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Save Settings</button>
            <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

<script>
function updateTotal() {
    const tax = parseFloat(document.getElementById('tax_percent').value) || 0;
    const reinvest = parseFloat(document.getElementById('reinvest_percent').value) || 0;
    const takeHome = parseFloat(document.getElementById('take_home_percent').value) || 0;
    const total = tax + reinvest + takeHome;
    document.getElementById('total_percent').textContent = total.toFixed(1);
    
    const totalElement = document.getElementById('total_percent');
    if (Math.abs(total - 100) < 0.01) {
        totalElement.style.color = 'green';
    } else {
        totalElement.style.color = 'red';
    }
}

function validatePercentages() {
    const tax = parseFloat(document.getElementById('tax_percent').value) || 0;
    const reinvest = parseFloat(document.getElementById('reinvest_percent').value) || 0;
    const takeHome = parseFloat(document.getElementById('take_home_percent').value) || 0;
    const total = tax + reinvest + takeHome;
    
    if (Math.abs(total - 100) > 0.01) {
        alert(`Percentages must sum to 100%. Current sum: ${total.toFixed(2)}%`);
        return false;
    }
    return true;
}

// Update total on input change
document.getElementById('tax_percent').addEventListener('input', updateTotal);
document.getElementById('reinvest_percent').addEventListener('input', updateTotal);
document.getElementById('take_home_percent').addEventListener('input', updateTotal);

// Initialize on page load
updateTotal();
</script>
{% endblock %}

